(self.webpackChunk_jupyrdf_jupyter_elk=self.webpackChunk_jupyrdf_jupyter_elk||[]).push([[555],{5825:(e,t,s)=>{"use strict";s.r(t),s.d(t,{ELKDiagramModel:()=>Ce,ELKDiagramView:()=>De}),s(6218);var i=s(1966),o=s.n(i),n=s(6168),r=s(8081),l=s(3409),a=s(8036),d=s(6700);function c(e,t=""){return null==e||0==e.length?t:e}function u(e){var t;let s=((null===(t=e.properties)||void 0===t?void 0:t.cssClasses)||"").trim();return s?s.split(" "):[]}class h{constructor(){this.nodeIds=new Set,this.edgeIds=new Set,this.portIds=new Set,this.labelIds=new Set,this.sectionIds=new Set,this.defsIds=new Map,this.connectors=new Map}transform(e,t,s){const i={type:"graph",id:e.id||"root",children:[],cssClasses:u(e),defs:this.transformDefs(t,s)};if(e.children){const t=e.children.map(this.transformElkNode,this);i.children.push(...t)}if(e.edges){const t=e.edges.map(this.transformElkEdge,this);i.children.push(...t)}return i}transformDefs(e,t){let s=[];for(const i in e)s.push(this.transformDef(i,e[i],t));return{children:s}}transformDef(e,t,s){var i,o;let n=(null===(i=null==t?void 0:t.children)||void 0===i?void 0:i.map(this.transformDefElement,this))||[];return this.defsIds[e]=`${s}_${e}`,"connectordef"==(null===(o=null==t?void 0:t.properties)||void 0===o?void 0:o.type)&&(this.connectors[e]=t),{type:"def",id:e,children:n,position:this.pos(t),size:this.size(t),properties:t.properties}}transformDefElement(e){var t;return e.properties.isDef=!0,{id:e.id,position:this.pos(e),size:this.size(e),children:[],properties:e.properties,type:null===(t=e.properties)||void 0===t?void 0:t.type}}transformElkNode(e){var t;this.checkAndRememberId(e,this.nodeIds);const s={type:c(null===(t=null==e?void 0:e.properties)||void 0===t?void 0:t.type,"node"),id:e.id,position:this.pos(e),size:this.size(e),children:[],cssClasses:u(e),properties:null==e?void 0:e.properties,layoutOptions:null==e?void 0:e.layoutOptions};if(e.children){const t=e.children.map(this.transformElkNode,this);s.children.push(...t)}if(e.ports){const t=e.ports.map(this.transformElkPort,this);s.children.push(...t)}if(e.labels){const t=e.labels.map(this.transformElkLabel,this);s.children.push(...t)}if(e.edges){const t=e.edges.map(this.transformElkEdge,this);s.children.push(...t)}return s}transformElkPort(e){var t;this.checkAndRememberId(e,this.portIds);const s={type:c(null===(t=e.properties)||void 0===t?void 0:t.type,"port"),id:e.id,position:this.pos(e),size:this.size(e),children:[],cssClasses:u(e),properties:null==e?void 0:e.properties,layoutOptions:null==e?void 0:e.layoutOptions};if(e.labels){const t=e.labels.map(this.transformElkLabel,this);s.children.push(...t)}return s}transformElkLabel(e){var t;this.checkAndRememberId(e,this.labelIds);let s={type:c(null===(t=e.properties)||void 0===t?void 0:t.type,"label"),id:e.id,text:e.text,position:this.pos(e),size:this.size(e),cssClasses:u(e),labels:[],properties:null==e?void 0:e.properties,layoutOptions:null==e?void 0:e.layoutOptions};if(e.labels){const t=e.labels.map(this.transformElkLabel,this);s.labels.push(...t)}return s}transformElkEdge(e){var t;this.checkAndRememberId(e,this.edgeIds);const s={type:c(null===(t=e.properties)||void 0===t?void 0:t.type,"edge"),id:e.id,sourceId:"",targetId:"",routingPoints:[],children:[],cssClasses:u(e),properties:null==e?void 0:e.properties,layoutOptions:null==e?void 0:e.layoutOptions};var i;if(null!=(i=e).source&&null!=i.target?(s.sourceId=e.source,s.targetId=e.target,e.sourcePoint&&s.routingPoints.push(e.sourcePoint),e.bendPoints&&s.routingPoints.push(...e.bendPoints),e.targetPoint&&s.routingPoints.push(e.targetPoint)):function(e){return null!=e.sources&&null!=e.targets}(e)&&(s.sourceId=e.sources[0],s.targetId=e.targets[0],e.sections&&e.sections.forEach((e=>{this.checkAndRememberId(e,this.sectionIds),s.routingPoints.push(e.startPoint),e.bendPoints&&s.routingPoints.push(...e.bendPoints),s.routingPoints.push(e.endPoint)}))),e.junctionPoints&&e.junctionPoints.forEach(((t,i)=>{const o={type:"junction",id:e.id+"_j"+i,position:t};s.children.push(o)})),e.labels){const t=e.labels.map(this.transformElkLabel,this);s.children.push(...t)}return s}pos(e){return{x:e.x||0,y:e.y||0}}size(e){return{width:e.width||0,height:e.height||0}}checkAndRememberId(e,t){if(null==e.id)throw Error("An element is missing an id.");if(t.has(e.id))throw Error("Duplicate id: "+e.id+".");t.add(e.id)}}let p=class extends l.LocalModelSource{async updateLayout(e,t,s){this.elkToSprotty=new h;let i=this.elkToSprotty.transform(e,t,s);await this.updateModel(i)}async getSelected(){let e=[];return(await this.getSelection()).forEach(((t,s)=>{e.push(t.id)})),e}element(){return document.getElementById(this.viewerOptions.baseDiv)}center(e=[],t=!0,s=!1){let i=new l.CenterAction(e,t,s);this.actionDispatcher.dispatch(i)}fit(e=[],t,s,i){let o=new l.FitToScreenAction(e,t,s,i);this.actionDispatcher.dispatch(o)}resize(e){let t=new l.InitializeCanvasBoundsAction(e);this.actionDispatcher.dispatch(t)}async getViewport(){const e=await this.actionDispatcher.request(l.GetViewportAction.create());return{scroll:e.viewport.scroll,zoom:e.viewport.zoom,canvasBounds:e.canvasBounds}}};p=function(e,t,s,i){var o,n=arguments.length,r=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,i);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(r=(n<3?o(r):n>3?o(t,s,r):o(t,s))||r);return n>3&&r&&Object.defineProperty(t,s,r),r}([(0,d.injectable)()],p);var g=s(2388);const f={createElement:g.html};let m=class{render(e,t){const s=`scale(${e.zoom}) translate(${-e.scroll.x},${-e.scroll.y})`;let i=(0,g.svg)("svg",{class:{"sprotty-graph":!0}},[(0,g.svg)("g",{transform:s},t.renderChildren(e)),(0,g.svg)("g",{class:{elkdefs:!0}},t.renderChildren(e.defs))]);const o={transform:`scale(${e.zoom}) translateZ(0) translate(${-e.scroll.x}px,${-e.scroll.y}px)`};let n=f.createElement("div",{"class-sprotty-overlay":!0,style:o},t.renderWidgets());return f.createElement("div",{"class-sprotty-root":!0},i,n)}};m=function(e,t,s,i){var o,n=arguments.length,r=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,i);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(r=(n<3?o(r):n>3?o(t,s,r):o(t,s))||r);return n>3&&r&&Object.defineProperty(t,s,r),r}([(0,d.injectable)()],m);var v=function(e,t,s,i){var o,n=arguments.length,r=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,i);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(r=(n<3?o(r):n>3?o(t,s,r):o(t,s))||r);return n>3&&r&&Object.defineProperty(t,s,r),r};const y={createElement:g.svg};function b(e){return`${e.x},${e.y}`}let w=class extends l.RectangularNodeView{render(e,t){if(!this.isDef(e)&&!this.isVisible(e,t))return;let s=this.renderMark(e,t);return this.isDef(e)||((0,l.setClass)(s,"elknode",!0),(0,l.setClass)(s,"mouseover",e.hoverFeedback),(0,l.setClass)(s,"selected",e.selected)),(0,l.setClass)(s,e.type,!0),y.createElement("g",null,s,y.createElement("g",{"class-elkchildren":!0},this.renderChildren(e,t)))}renderMark(e,t){return y.createElement("rect",{x:"0",y:"0",width:e.size.width,height:e.size.height})}renderChildren(e,t){return t.renderChildren(e)}isDef(e){var t;return 1==(null===(t=null==e?void 0:e.properties)||void 0===t?void 0:t.isDef)}};w=v([(0,d.injectable)()],w);let E=class extends w{renderMark(e,t){let s=e.size.width,i=e.size.height;const o={x:s,y:i/2},n={x:0,y:i/2},r={x:s/2,y:i},l=`${b({x:s/2,y:0})} ${b(o)} ${b(r)} ${b(n)}`;return y.createElement("polygon",{points:l})}};E=v([(0,d.injectable)()],E);let x=class extends w{renderMark(e,t){var s,i,o,n;let r=e.size.width/2,l=e.size.height/2,a=null===(i=null===(s=e.properties)||void 0===s?void 0:s.shape)||void 0===i?void 0:i.x;null==a&&(a=r);let d=null===(n=null===(o=e.properties)||void 0===o?void 0:o.shape)||void 0===n?void 0:n.y;return null==d&&(d=l),y.createElement("ellipse",{rx:r,ry:l,cx:a,cy:d})}};x=v([(0,d.injectable)()],x);let M=class extends w{renderMark(e,t){var s,i;let o=e.size.width,n=e.size.height;return y.createElement("image",{width:o,height:n,href:null===(i=null===(s=e.properties)||void 0===s?void 0:s.shape)||void 0===i?void 0:i.use})}};M=v([(0,d.injectable)()],M);let S=class extends w{renderMark(e,t){var s,i;let o=Number(null===(i=null===(s=null==e?void 0:e.properties)||void 0===s?void 0:s.shape)||void 0===i?void 0:i.use)||15,n=e.size.width,r=e.size.height;const l=[{x:0,y:0},{x:n-o,y:0},{x:n,y:o},{x:n,y:r},{x:0,y:r}].map(b).join(" ");return y.createElement("polygon",{points:l})}};S=v([(0,d.injectable)()],S);let k=class extends w{renderMark(e,t){var s,i;let o=null===(i=null===(s=null==e?void 0:e.properties)||void 0===s?void 0:s.shape)||void 0===i?void 0:i.use;return y.createElement("path",{d:o})}};k=v([(0,d.injectable)()],k);let C=class extends w{renderMark(e,t){var s,i;let o=null===(i=null===(s=null==e?void 0:e.properties)||void 0===s?void 0:s.shape)||void 0===i?void 0:i.use,n=t.hrefID(o),r=y.createElement("use",{href:"#"+n,width:e.size.width,height:e.size.height});return(0,l.setClass)(r,o,!0),r}};C=v([(0,d.injectable)()],C);let D=class extends w{renderMark(e,t){var s,i,o,n,r,l;let a=null===(i=null===(s=e.properties)||void 0===s?void 0:s.shape)||void 0===i?void 0:i.x,d=null===(n=null===(o=e.properties)||void 0===o?void 0:o.shape)||void 0===n?void 0:n.y;return y.createElement("g",{props:{innerHTML:null===(l=null===(r=null==e?void 0:e.properties)||void 0===r?void 0:r.shape)||void 0===l?void 0:l.use},transform:`translate(${a} ${d})`},[])}};D=v([(0,d.injectable)()],D);let P=class extends w{renderMark(e,t){if(e.parent.type==e.type){const t=e.parent.size;return y.createElement("rect",{x:"0",y:"0",width:t.width,height:e.size.height})}return super.renderMark(e,t)}};P=v([(0,d.injectable)()],P);let R=class extends w{renderMark(e,t){var s,i;let o=(0,g.html)("div",{props:{innerHTML:null===(i=null===(s=null==e?void 0:e.properties)||void 0===s?void 0:s.shape)||void 0===i?void 0:i.use}},[]);return y.createElement("foreignObject",{requiredFeatures:"http://www.w3.org/TR/SVG11/feature#Extensibility",height:e.size.height,width:e.size.width,x:0,y:0},o)}};R=v([(0,d.injectable)()],R);let j=class extends w{render(e,t){if(!this.isDef(e)&&!this.isVisible(e,t))return;let s=this.renderMark(e,t);return this.isDef(e)||((0,l.setClass)(s,"elknode",!0),(0,l.setClass)(s,"mouseover",e.hoverFeedback),(0,l.setClass)(s,"selected",e.selected)),(0,l.setClass)(s,e.type,!0),(0,g.svg)("g",{hook:{insert:s=>t.overlayContent(s,e,!0),destroy:s=>t.overlayContent(s,e,!1),update:(s,i)=>t.overlayContent(i,e,this.isVisible(e,t))}},[s,y.createElement("g",{"class-elkchildren":!0},this.renderChildren(e,t))])}};j=v([(0,d.injectable)()],j);let O=class extends l.RectangularNodeView{render(e,t){var s,i;let o,n=null===(i=null===(s=null==e?void 0:e.properties)||void 0===s?void 0:s.shape)||void 0===i?void 0:i.use,r=t.hrefID(n);return r?(o=y.createElement("use",{"class-elkport":!0,"class-mouseover":e.hoverFeedback,"class-selected":e.selected,href:"#"+r}),(0,l.setClass)(o,n,!0)):o=y.createElement("rect",{"class-elkport":!0,"class-mouseover":e.hoverFeedback,"class-selected":e.selected,x:"0",y:"0",width:e.size.width,height:e.size.height}),y.createElement("g",null,o,t.renderChildren(e))}};O=v([(0,d.injectable)()],O);let _=class extends l.ShapeView{render(e,t){var s,i,o,n,r;if(!this.isVisible(e,t))return;let a,d=null===(i=null===(s=null==e?void 0:e.properties)||void 0===s?void 0:s.shape)||void 0===i?void 0:i.use,c=t.hrefID(d);if(c?(a=y.createElement("use",{"class-elklabel":!0,href:"#"+c,width:e.size.width,height:e.size.height}),(0,l.setClass)(a,d,!0)):a=y.createElement("text",{"class-elklabel":!0},e.text),null===(o=e.labels)||void 0===o?void 0:o.length){console.log("sub labeling to do...");let s=e.labels[0],i=null===(r=null===(n=null==s?void 0:s.properties)||void 0===n?void 0:n.shape)||void 0===r?void 0:r.use,o=t.hrefID(i),l=e.size.height,d=this.dimension(s),c=this.dimension(e),u={x:0+s.position.x,y:(l-d.height)/2+s.position.x},h=(null==s?void 0:s.layoutOptions)||{},p=Number(h["org.eclipse.elk.spacing.labelLabel"])||0,g={x:d.width+p,y:(l-c.height)/2};a=y.createElement("g",null,y.createElement("use",{transform:`translate(${u.x} ${u.y})`,"class-elklabel":!0,href:"#"+o,width:s.size.width,height:s.size.height}),y.createElement("g",{transform:`translate(${g.x} ${g.y})`},a))}return a}dimension(e){var t,s,i,o;return{width:(null===(s=null===(t=null==e?void 0:e.properties)||void 0===t?void 0:t.shape)||void 0===s?void 0:s.width)||e.size.width,height:(null===(o=null===(i=null==e?void 0:e.properties)||void 0===i?void 0:i.shape)||void 0===o?void 0:o.height)||e.size.height}}isVisible(e,t){if(!super.isVisible(e,t))return!1;let s,i=e.root.zoom;return s=!e.size.height||i*e.size.height>3,s}};_=v([(0,d.injectable)()],_);var I=function(e,t,s,i){var o,n=arguments.length,r=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,i);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(r=(n<3?o(r):n>3?o(t,s,r):o(t,s))||r);return n>3&&r&&Object.defineProperty(t,s,r),r};const T={createElement:g.svg};let z=class extends l.CircularNodeView{render(e,t){const s=this.getRadius(e);return T.createElement("g",null,T.createElement("circle",{"class-elkjunction":!0,r:s}))}getRadius(e){return 2}};z=I([(0,d.injectable)()],z);let F=class extends l.PolylineEdgeView{render(e,t){const s=this.edgeRouterRegistry.get(e.routerKind).route(e);if(0===s.length)return this.renderDanglingEdge("Cannot compute route",e,t);if(!this.isVisible(e,s,t)){if(0===e.children.length)return;return T.createElement("g",null,t.renderChildren(e,{route:s}))}return T.createElement("g",{"class-elkedge":!0,"class-mouseover":e.hoverFeedback},this.renderLine(e,s,t),this.renderAdditionals(e,s,t),t.renderChildren(e,{route:s}))}renderLine(e,t,s){var i,o,n,r;const a=t[1],d=t[0];let c=(0,l.angleOfPoint)({x:a.x-d.x,y:a.y-d.y});const u=t[t.length-2],h=t[t.length-1];let p=(0,l.angleOfPoint)({x:u.x-h.x,y:u.y-h.y}),g=this.getPathOffset(null===(o=null===(i=null==e?void 0:e.properties)||void 0===i?void 0:i.shape)||void 0===o?void 0:o.start,s,c),f=this.getPathOffset(null===(r=null===(n=null==e?void 0:e.properties)||void 0===n?void 0:n.shape)||void 0===r?void 0:r.end,s,p);const m=t[0];let v=`M ${m.x-g.x},${m.y-g.y}`;for(let e=1;e<t.length-1;e++){const s=t[e];v+=` L ${s.x},${s.y}`}const y=t[t.length-1];return v+=` L ${y.x-f.x}, ${y.y-f.y}`,T.createElement("path",{d:v})}getAnchorCorrection(e,t,s){let i=t.getConnector(e);if(null==i?void 0:i.correction){const e=i.correction;return{x:e.x*Math.cos(s)-e.y*Math.sin(s),y:e.x*Math.sin(s)+e.y*Math.cos(s)}}return{x:0,y:0}}getPathOffset(e,t,s){let i=t.getConnector(e);if(null==i?void 0:i.offset){const e=i.offset;return{x:e.x*Math.cos(s)-e.y*Math.sin(s),y:e.x*Math.sin(s)+e.y*Math.cos(s)}}return{x:0,y:0}}renderAdditionals(e,t,s){var i,o,n,r;let a,d,c,u=[],h=null===(o=null===(i=null==e?void 0:e.properties)||void 0===i?void 0:i.shape)||void 0===o?void 0:o.start,p=null===(r=null===(n=null==e?void 0:e.properties)||void 0===n?void 0:n.shape)||void 0===r?void 0:r.end;if(h){const e=t[1],i=t[0];let o=(0,l.angleOfPoint)({x:e.x-i.x,y:e.y-i.y});d=this.getAnchorCorrection(h,s,o);let n=i.x-d.x,r=i.y-d.y;a=s.hrefID(h),c=T.createElement("use",{href:"#"+a,"class-elkedge-start":!0,"class-elkarrow":!0,transform:`rotate(${(0,l.toDegrees)(o)} ${n} ${r}) translate(${n} ${r})`}),(0,l.setClass)(c,h,!0),u.push(c)}if(p){const e=t[t.length-2],i=t[t.length-1];let o=(0,l.angleOfPoint)({x:e.x-i.x,y:e.y-i.y});d=this.getAnchorCorrection(p,s,o);let n=i.x-d.x,r=i.y-d.y;a=s.hrefID(p),c=T.createElement("use",{href:"#"+a,"class-elkedge-end":!0,"class-elkarrow":!0,transform:`rotate(${(0,l.toDegrees)(o)} ${n} ${r}) translate(${n} ${r})`}),(0,l.setClass)(c,p,!0),u.push(c)}return u}};F=I([(0,d.injectable)()],F);let L=class{render(e,t){var s,i,o,n;let r=(null===(i=null===(s=e.properties)||void 0===s?void 0:s.shape)||void 0===i?void 0:i.x)||0,l=(null===(n=null===(o=e.properties)||void 0===o?void 0:o.shape)||void 0===n?void 0:n.y)||0,a=e.size.width||0,d=e.size.height||0,c={class:{[e.id]:!0}};return a&&d&&(c.viewBox=`${r} ${l} ${a} ${d}`),(0,g.svg)("symbol",c,t.renderChildren(e))}};L=function(e,t,s,i){var o,n=arguments.length,r=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,i);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(r=(n<3?o(r):n>3?o(t,s,r):o(t,s))||r);return n>3&&r&&Object.defineProperty(t,s,r),r}([(0,d.injectable)()],L);class A extends l.RectangularNode{hasFeature(e){return e!==l.moveFeature&&super.hasFeature(e)}}class $ extends l.RectangularPort{hasFeature(e){return e!==l.moveFeature&&super.hasFeature(e)}}class N extends l.SEdge{hasFeature(e){return e!==l.editFeature&&super.hasFeature(e)}}class V extends l.SNode{hasFeature(e){return e!==l.moveFeature&&e!==l.selectFeature&&e!==l.hoverFeedbackFeature&&super.hasFeature(e)}}class Y extends l.SNode{hasFeature(e){return e!==l.moveFeature&&super.hasFeature(e)}}var K=s(6510);class B extends l.ModelRenderer{constructor(e,t,s,i){super(e,t,s),this.viewRegistry=e,this.targetKind=t,this.source=i,this.widgets=new Map}renderWidgets(e){let t=[];for(let s in this.widgets){let i=this.widgets[s],o=this.widgetContainer(i,e);void 0!==o&&(this.decorate(o,i.node),t.push(o))}return t}widgetContainer(e,t){if(!e.visible)return;let s=e.node.bounds,i=function(e){var t,s;let i=0,o=0;for(;void 0!==e;)i+=(null===(t=e.bounds)||void 0===t?void 0:t.x)||0,o+=(null===(s=e.bounds)||void 0===s?void 0:s.y)||0,e=null==e?void 0:e.parent;return{x:i,y:o}}(e.node),o={transform:`translate(${i.x}px, ${i.y}px)`,width:`${s.width}px`,height:`${s.height}px`,background:"#9dd8d857"},n={};return e.html&&(n={innerHTML:e.html}),(0,g.html)("div",{key:e.node.id,class:{elkcontainer:!0},style:o,props:n,hook:{insert:t=>this.renderContent(t,e)}},[])}async renderContent(e,t,s){if("widget"==(0,l.getSubType)(t.node)){let s=t.widget,i=await this.source.widget_manager.create_view(s,{});K.Widget.attach(i.pWidget,e.elm)}}async overlayContent(e,t,s){var i,o;let n,r,a=null===(o=null===(i=t.properties)||void 0===i?void 0:i.shape)||void 0===o?void 0:o.use;"widget"==(0,l.getSubType)(t)?a&&(n=await this.source.widget_manager.get_model(a),r=void 0):(n=void 0,r=a),this.widgets[t.id]={vnode:e,node:t,widget:n,visible:s,html:r}}getConnector(e){var t;return null===(t=this.source.elkToSprotty)||void 0===t?void 0:t.connectors[e]}hrefID(e){if(e)return this.source.elkToSprotty.defsIds[e]}}class H extends l.SModelFactory{initializeRoot(e,t){var s;return(null===(s=e=super.initializeRoot(e,t))||void 0===s?void 0:s.defs)&&(e.defs.children=t.defs.children.map((t=>this.createElement(t,e)))),e}}const U={IFeedbackActionDispatcher:Symbol.for("IFeedbackActionDispatcher"),IToolFactory:Symbol.for("Factory<Tool>"),IEditConfigProvider:Symbol.for("IEditConfigProvider"),RequestResponseSupport:Symbol.for("RequestResponseSupport"),SelectionService:Symbol.for("SelectionService"),SelectionListener:Symbol.for("SelectionListener"),SModelRootListener:Symbol.for("SModelRootListener"),MouseTool:Symbol.for("MouseTool"),ViewerOptions:Symbol.for("ViewerOptions")};class W extends l.Command{constructor(){super(...arguments),this.priority=0}undo(e){return e.root}redo(e){return e.root}}var G;!function(e){e.DEFAULT="default-mode",e.OVERLAP_FORBIDDEN="overlap-forbidden-mode",e.NODE_CREATION="node-creation-mode",e.EDGE_CREATION_SOURCE="edge-creation-select-source-mode",e.EDGE_CREATION_TARGET="edge-creation-select-target-mode",e.EDGE_RECONNECT="edge-reconnect-select-target-mode",e.OPERATION_NOT_ALLOWED="edge-modification-not-allowed-mode",e.ELEMENT_DELETION="element-deletion-mode",e.MOUSEOVER="mouseover",e.SELECTED="selected"}(G||(G={}));let q=class extends W{constructor(e){super(),this.action=e}execute(e){return function(e,t){if(null!=e.cssClasses&&0!==e.cssClasses.length)for(const s of t)-1!==e.cssClasses.indexOf(s)&&e.cssClasses.splice(e.cssClasses.indexOf(s),1)}(this.action.target,Object.values(G)),this.action.cssClass&&function(e,t){null==e.cssClasses&&(e.cssClasses=[]);for(const s of t)e.cssClasses.indexOf(s)<0&&e.cssClasses.push(s)}(this.action.target,[this.action.cssClass]),e.root}};var X,Z;q.KIND="applyCursorCssFeedback",q=function(e,t,s,i){var o,n=arguments.length,r=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,i);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(r=(n<3?o(r):n>3?o(t,s,r):o(t,s))||r);return n>3&&r&&Object.defineProperty(t,s,r),r}([(0,d.injectable)(),(X=0,Z=(0,d.inject)(l.TYPES.Action),function(e,t){Z(e,t,X)}),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[class{constructor(e,t){this.target=e,this.cssClass=t,this.kind=q.KIND}}])],q);var J=function(e,t){return function(s,i){t(s,i,e)}};let Q=class{constructor(e,t){this.actionDispatcher=e,this.logger=t,this.feedbackEmitters=new Map}registerFeedback(e,t){this.feedbackEmitters.set(e,t),this.dispatch(t,e)}deregisterFeedback(e,t){this.feedbackEmitters.delete(e),this.dispatch(t,e)}dispatch(e,t){this.actionDispatcher().then((t=>t.dispatchAll(e))).then((()=>this.logger.info(this,`Dispatched feedback actions for ${t}`))).catch((e=>this.logger.error(this,"Failed to dispatch feedback actions",e)))}getRegisteredFeedback(){const e=[];return this.feedbackEmitters.forEach(((t,s)=>e.push(...t))),e}getRegisteredFeedbackEmitters(e){const t=[];return this.feedbackEmitters.forEach(((s,i)=>{s.find((t=>t===e))&&t.push(i)})),t}};Q=function(e,t,s,i){var o,n=arguments.length,r=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,i);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(r=(n<3?o(r):n>3?o(t,s,r):o(t,s))||r);return n>3&&r&&Object.defineProperty(t,s,r),r}([(0,d.injectable)(),J(0,(0,d.inject)(l.TYPES.IActionDispatcherProvider)),J(1,(0,d.inject)(l.TYPES.ILogger)),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[Function,Object])],Q);const ee=new d.ContainerModule(((e,t,s)=>{e(U.IFeedbackActionDispatcher).to(Q).inSingletonScope(),(0,l.configureCommand)({bind:e,isBound:s},q),(0,l.configureCommand)({bind:e,isBound:s},l.MoveCommand),(0,l.configureCommand)({bind:e,isBound:s},l.SelectCommand),(0,l.configureCommand)({bind:e,isBound:s},l.SelectAllCommand),(0,l.configureCommand)({bind:e,isBound:s},l.GetSelectionCommand),e(l.TYPES.IVNodePostprocessor).to(l.LocationPostprocessor),e(l.TYPES.HiddenVNodePostprocessor).to(l.LocationPostprocessor)}));var te=function(e,t,s,i){var o,n=arguments.length,r=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,i);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(r=(n<3?o(r):n>3?o(t,s,r):o(t,s))||r);return n>3&&r&&Object.defineProperty(t,s,r),r},se=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},ie=function(e,t){return function(s,i){t(s,i,e)}};let oe=class extends l.ScrollMouseListener{constructor(e){super(),this.model_source=e}mouseDown(e,t){if(null==(0,l.findParentByFeature)(e,l.isMoveable)&&!(e instanceof l.SRoutingHandle))if("node:widget"==e.type)this.lastScrollPosition=void 0;else{const s=(0,l.findParentByFeature)(e,l.isViewport);this.lastScrollPosition=s?{x:t.pageX,y:t.pageY}:void 0}return[]}mouseMove(e,t){if(0===t.buttons)this.mouseUp(e,t);else if(this.lastScrollPosition){const s=(0,l.findParentByFeature)(e,l.isViewport);if(s){const e=(t.pageX-this.lastScrollPosition.x)/s.zoom,i=(t.pageY-this.lastScrollPosition.y)/s.zoom,o={scroll:{x:s.scroll.x-e,y:s.scroll.y-i},zoom:s.zoom};return this.lastScrollPosition={x:t.pageX,y:t.pageY},[new l.SetViewportAction(s.id,o,!1)]}}return[]}};oe=te([ie(0,(0,d.inject)(l.TYPES.ModelSource)),se("design:paramtypes",[p])],oe);let ne=class extends l.ZoomMouseListener{constructor(e){super(),this.model_source=e}getViewportOffset(e,t){const s=this.model_source.element().getBoundingClientRect();return{x:t.clientX-s.left,y:t.clientY-s.top}}};ne=te([ie(0,(0,d.inject)(l.TYPES.ModelSource)),se("design:paramtypes",[p])],ne);const re=new d.ContainerModule(((e,t,s)=>{(0,l.configureCommand)({bind:e,isBound:s},l.CenterCommand),(0,l.configureCommand)({bind:e,isBound:s},l.FitToScreenCommand),(0,l.configureCommand)({bind:e,isBound:s},l.SetViewportCommand),(0,l.configureCommand)({bind:e,isBound:s},l.GetViewportCommand),e(l.TYPES.KeyListener).to(l.CenterKeyboardListener),e(l.TYPES.MouseListener).to(oe),e(l.TYPES.MouseListener).to(ne)}));class le extends l.SvgExporter{isExported(e){return null!=e.href&&(e.href.endsWith("diagram.css")||e.href.endsWith("sprotty.css"))}}var ae=s(9140);class de extends l.MouseListener{constructor(){super(...arguments),this.isMouseDown=!1,this.isMouseDrag=!1}mouseDown(e,t){return this.isMouseDown=!0,[]}mouseMove(e,t){return this.isMouseDown&&(this.isMouseDrag=!0),[]}mouseUp(e,t){return this.isMouseDown=!1,this.isMouseDrag?(this.isMouseDrag=!1,this.draggingMouseUp(e,t)):this.nonDraggingMouseUp(e,t)}nonDraggingMouseUp(e,t){return[]}draggingMouseUp(e,t){return[]}}class ce extends de{constructor(e,t){super(),this.elementTypeId=e,this.tool=t}mouseOver(e,t){return[new l.HoverFeedbackAction(e.id,!0)]}mouseOut(e,t){return[new l.HoverFeedbackAction(e.id,!1)]}}let ue=class{constructor(){this.elementTypeId="unknown",this.operationKind="generic"}get id(){return`tool_${this.operationKind}_${this.elementTypeId}`}enable(){}disable(){}dispatchFeedback(e){}};function he(e){return e.id}ue=function(e,t,s,i){var o,n=arguments.length,r=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,i);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(r=(n<3?o(r):n>3?o(t,s,r):o(t,s))||r);return n>3&&r&&Object.defineProperty(t,s,r),r}([(0,d.injectable)()],ue);var pe=function(e,t,s,i){var o,n=arguments.length,r=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,i);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(r=(n<3?o(r):n>3?o(t,s,r):o(t,s))||r);return n>3&&r&&Object.defineProperty(t,s,r),r},ge=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},fe=function(e,t){return function(s,i){t(s,i,e)}};let me=class extends ue{constructor(e,t){super(),this.mouseTool=e,this.feedbackDispatcher=t,this.elementTypeId="unknown",this.operationKind=l.SelectAction.KIND}enable(){this.selectionToolMouseListener=new ve(this.elementTypeId,this),this.mouseTool.register(this.selectionToolMouseListener)}disable(){this.mouseTool.deregister(this.selectionToolMouseListener)}};me=pe([(0,d.injectable)(),fe(0,(0,d.inject)(l.MouseTool)),fe(1,(0,d.inject)(U.IFeedbackActionDispatcher)),ge("design:paramtypes",[Object,Object])],me);let ve=class extends ce{constructor(e,t){super(e,t),this.elementTypeId=e,this.tool=t}nonDraggingMouseUp(e,t){let s=[],i=[];if(0===t.button){const o=(0,l.findParentByFeature)(e,l.isSelectable);(null!=o||e instanceof l.SModelRoot)&&((0,l.isCtrlOrCmd)(t)||(i=(0,ae.toArray)(e.root.index.all().filter((e=>(0,l.isSelectable)(e)&&e.selected&&!(o instanceof l.SRoutingHandle&&e===o.parent))))),null!=o&&(o.selected?(0,l.isCtrlOrCmd)(t)&&(i=[o]):s=[o]))}return[new l.SelectAction(s.map(he),i.map(he))]}decorate(e,t){const s=(0,l.findParentByFeature)(t,l.isSelectable);return null!=s&&(0,l.setClass)(e,"selected",s.selected),e}};ve=pe([(0,d.injectable)(),ge("design:paramtypes",[String,me])],ve);var ye=function(e,t,s,i){var o,n=arguments.length,r=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,i);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(r=(n<3?o(r):n>3?o(t,s,r):o(t,s))||r);return n>3&&r&&Object.defineProperty(t,s,r),r},be=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},we=function(e,t){return function(s,i){t(s,i,e)}};class Ee{constructor(e=[],t=[]){this.expandElementsIDs=e,this.contractElementsIDs=t,this.kind=l.SelectAction.KIND}}Ee.KIND="elementExpand";let xe=class extends ue{constructor(e,t){super(),this.mouseTool=e,this.feedbackDispatcher=t,this.elementTypeId="unknown",this.operationKind=Ee.KIND}enable(){this.expansionToolMouseListener=new Me(this.elementTypeId,this),this.mouseTool.register(this.expansionToolMouseListener)}disable(){this.mouseTool.deregister(this.expansionToolMouseListener)}dispatchFeedback(e){this.feedbackDispatcher.registerFeedback(this,e)}};xe=ye([(0,d.injectable)(),we(0,(0,d.inject)(l.MouseTool)),we(1,(0,d.inject)(U.IFeedbackActionDispatcher)),be("design:paramtypes",[Object,Object])],xe);let Me=class extends de{constructor(e,t){super(),this.elementTypeId=e,this.tool=t}wheel(e,t){return[]}decorate(e,t){const s=(0,l.findParentByFeature)(t,l.isSelectable);return null!=s&&(0,l.setClass)(e,"selected",s.selected),e}};Me=ye([(0,d.injectable)(),be("design:paramtypes",[String,xe])],Me);var Se=s(1797);const ke={id:"root"};class Ce extends r.DOMWidgetModel{constructor(){super(...arguments),this.layoutUpdated=new n.Signal(this)}defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:Ce.model_name,_model_module_version:a.q4,_view_module:a.A1,_view_name:De.view_name,_view_module_version:a.q4,value:ke,defs:{},mark_layout:{},layouter:{}})}initialize(e,t){super.initialize(e,t),this.on("change:value",this.value_changed,this),this.value_changed().catch((e=>console.error(e)))}async value_changed(){let e,t=this.get("value"),s=await this.layoutEngine();e=s?await s.layout(t):t,this.set("mark_layout",e)}async layoutEngine(){let e=this.get("layouter").replace("IPY_MODEL_","");return await this.widget_manager.get_model(e)}}Ce.model_name="ELKModel";class De extends r.DOMWidgetView{constructor(){super(...arguments),this.was_shown=new Se.PromiseDelegate,this.wait_for_visible=(e=!1)=>{this.pWidget.isVisible?setTimeout(this.wait_for_visible,e?0:300):this.was_shown.resolve()},this.resize=(e=-1,t=-1)=>{if(-1===e||-1===t){const s=this.el.getBoundingClientRect();e=s.width,t=s.height}this.source.resize({width:e,height:t,x:0,y:0})}}initialize(e){super.initialize(e),this.pWidget.addClass(a.gJ.widget_class)}async render(){const e=this.el,t=document.createElement("div");this.div_id=t.id=Pe.next_id(),e.appendChild(t),this.initSprotty().catch(console.warn),this.wait_for_visible(!0)}async initSprotty(){await this.was_shown.promise;const e=((e,t)=>{const s=new d.ContainerModule(((t,s,i,o)=>{t(l.TYPES.ModelSource).to(p).inSingletonScope(),o(l.TYPES.ILogger).to(l.ConsoleLogger).inSingletonScope(),o(l.TYPES.LogLevel).toConstantValue(l.LogLevel.warn),o(l.TYPES.SvgExporter).to(le).inSingletonScope();const n={bind:t,unbind:s,isBound:i,rebind:o};(0,l.configureModelElement)(n,"graph",l.SGraph,m),(0,l.configureModelElement)(n,"node",A,w),(0,l.configureModelElement)(n,"node:use",A,C),(0,l.configureModelElement)(n,"node:diamond",A,E),(0,l.configureModelElement)(n,"node:round",A,x),(0,l.configureModelElement)(n,"node:image",A,M),(0,l.configureModelElement)(n,"node:comment",A,S),(0,l.configureModelElement)(n,"node:path",A,k),(0,l.configureModelElement)(n,"node:svg",A,D),(0,l.configureModelElement)(n,"node:html",A,j),(0,l.configureModelElement)(n,"node:widget",A,j),(0,l.configureModelElement)(n,"node:compartment",A,P),(0,l.configureModelElement)(n,"node:foreignobject",A,R),(0,l.configureModelElement)(n,"port",$,O),(0,l.configureModelElement)(n,"edge",N,F),(0,l.configureModelElement)(n,"label",l.SLabel,_),(0,l.configureModelElement)(n,"label:icon",l.SLabel,_),(0,l.configureModelElement)(n,"junction",V,z),(0,l.configureViewerOptions)(n,{needsClientLayout:!1,baseDiv:e}),(0,l.configureCommand)(n,l.HoverFeedbackCommand),(0,l.configureModelElement)(n,"def",Y,L),o(l.TYPES.ModelRendererFactory).toFactory((e=>(t,s)=>{const i=e.container.get(l.TYPES.ViewRegistry),o=e.container.get(l.TYPES.ModelSource);return new B(i,t,s,o)})),o(l.TYPES.IModelFactory).to(H).inSingletonScope()})),i=new d.Container;return i.load(l.defaultModule,l.boundsModule,l.moveModule,l.fadeModule,l.updateModule,l.undoRedoModule,re,l.routingModule,l.exportModule,l.modelSourceModule,l.edgeEditModule,l.labelEditModule,ee,s),i})(this.div_id);this.container=e,this.source=e.get(l.TYPES.ModelSource),this.source.widget_manager=this.model.widget_manager,this.elementRegistry=e.get(l.TYPES.SModelRegistry),this.toolManager=e.get(l.TYPES.IToolManager),this.registry=e.get(l.ActionHandlerRegistry),this.actionDispatcher=e.get(l.TYPES.IActionDispatcher),this.feedbackDispatcher=e.get(U.IFeedbackActionDispatcher),this.model.on("change:mark_layout",this.diagramLayout,this),this.model.on("change:selected",this.updateSelected,this),this.model.on("change:hovered",this.updateHover,this),this.model.on("change:interaction",this.interaction_mode_changed,this),this.model.on("msg:custom",this.handleMessage,this),this.model.on("change:defs",this.diagramLayout,this),this.touch(),this.registry.register(l.SelectAction.KIND,this),this.registry.register(l.SelectionResult.KIND,this),this.registry.register(l.HoverFeedbackAction.KIND,this),this.toolManager.registerDefaultTools(e.resolve(me),e.resolve(xe)),this.toolManager.enableDefaultTools(),this.diagramLayout().catch((e=>console.warn("ELK Failed initial view render",e)))}processPhosphorMessage(e){switch(super.processPhosphorMessage(e),e.type){case"resize":const t=e;let{width:s,height:i}=t;this.resize(s,i);break;case"after-show":this.resize()}}handle(e){switch(e.kind){case l.SelectAction.KIND:this.source.getSelected().then((e=>{this.model.set("selected",e),this.touch()}));case l.SelectionResult.KIND:break;case l.HoverFeedbackAction.KIND:let t=e;t.mouseIsOver&&(this.model.set("hovered",t.mouseoverElement),this.touch())}}events(){return{click:"_handle_click"}}_handle_click(e){this.model.layoutUpdated.emit(),this.send({event:"click",id:this.model.get("hovered")})}updateSelected(){let e=this.model.get("selected"),t=this.model.previous("selected"),s=o()(t,e),i=o()(e,t);this.actionDispatcher.dispatch(new l.SelectAction(i,s))}updateHover(){let e=this.model.get("hovered"),t=this.model.previous("hovered");this.actionDispatcher.dispatchAll([new l.HoverFeedbackAction(e,!0),new l.HoverFeedbackAction(t,!1)])}async interaction_mode_changed(){}async diagramLayout(){let e=this.model.get("mark_layout"),t=this.model.get("defs");await this.source.updateLayout(e,t,this.div_id),this.model.layoutUpdated.emit()}normalizeElementIds(e){let t=[];return null!=e&&(t=Array.isArray(e)?e:[e]),t}handleMessage(e){switch(e.action){case"center":this.source.center(this.normalizeElementIds(e.model_id),e.animate,e.retain_zoom);break;case"fit":this.source.fit(this.normalizeElementIds(e.model_id),null==e.padding?0:e.padding,null==e.max_zoom?1/0:e.max_zoom,null==e.animate||e.animate);break;default:console.warn("ELK unhandled message",e)}}}var Pe;De.view_name="ELKDiagramView",function(e){let t=0;e.next_id=function(){return"sprotty_"+t++}}(Pe||(Pe={}))}}]);